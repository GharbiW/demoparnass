
{
  "entities": {
    "userProfile": {
      "title": "User Profile",
      "description": "Represents a user's profile information.",
      "type": "object",
      "properties": {
        "uid": {
          "type": "string",
          "description": "The user's unique ID."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name."
        },
        "photoURL": {
          "type": "string",
          "format": "uri",
          "description": "The URL of the user's profile picture."
        },
        "role": {
          "type": "string",
          "enum": ["admin", "ops", "driver"],
          "description": "The user's role in the system."
        },
        "orgId": {
          "type": "string",
          "description": "The organization ID the user belongs to."
        }
      },
      "required": ["uid", "email", "role", "orgId"]
    },
    "driver": {
      "title": "Driver",
      "description": "Represents a driver in the system.",
      "type": "object",
      "properties": {
        "driverId": { "type": "string" },
        "orgId": { "type": "string" },
        "userId": { "type": "string" },
        "name": { "type": "string" }
      }
    },
    "trip": {
      "title": "Trip",
      "description": "Represents a single trip.",
      "type": "object",
      "properties": {
        "tripId": { "type": "string" },
        "orgId": { "type": "string" },
        "driverId": { "type": "string" },
        "vehicleVin": { "type": "string" },
        "status": { "type": "string" }
      }
    },
    "inspectionSession": {
      "title": "Inspection Session",
      "description": "A session for a multi-angle video inspection of a vehicle.",
      "type": "object",
      "properties": {
        "sessionId": { "type": "string" },
        "orgId": { "type": "string" },
        "driverId": { "type": "string" },
        "tripId": { "type": "string" },
        "vehicleVin": { "type": "string" },
        "startedAt": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["open", "processing", "done", "failed"] }
      }
    },
    "driverExpense": {
      "title": "Driver Expense",
      "description": "An expense submitted by a driver.",
      "type": "object",
      "properties": {
        "expenseId": { "type": "string" },
        "orgId": { "type": "string" },
        "driverId": { "type": "string" },
        "tripId": { "type": "string" },
        "type": { "type": "string", "enum": ["carburant", "p√©age", "parking", "autre"] },
        "amount": { "type": "number" },
        "status": { "type": "string", "enum": ["submitted", "approved", "rejected"] }
      }
    },
    "directMessage": {
        "title": "Direct Message",
        "description": "A message between a driver and an operations user.",
        "type": "object",
        "properties": {
            "msgId": { "type": "string" },
            "orgId": { "type": "string" },
            "threadId": { "type": "string" },
            "participants": { "type": "array", "items": { "type": "string" }},
            "senderType": {"type": "string", "enum": ["driver", "ops"]},
            "body": {"type": "string"}
        }
    },
    "vehicleInspection": {
      "title": "Vehicle Inspection",
      "description": "A video inspection of a vehicle taken at a specific point in time.",
      "type": "object",
      "properties": {
        "inspectionId": { "type": "string" },
        "orgId": { "type": "string" },
        "tripId": { "type": "string" },
        "driverId": { "type": "string" },
        "vehicleVin": { "type": "string" },
        "type": { "type": "string", "enum": ["pre-trip", "post-trip"] },
        "createdAt": { "type": "string", "format": "date-time" },
        "videoUrl": { "type": "string", "format": "uri" },
        "status": { "type": "string", "enum": ["pending_upload", "processing", "analyzed", "error"] },
        "damageDetected": { "type": "boolean" }
      }
    },
    "aiChatSession": {
        "title": "AI Chat Session",
        "description": "A session for AI chat interactions.",
        "type": "object",
        "properties": {
            "sessionId": { "type": "string" },
            "orgId": { "type": "string" },
            "createdBy": { "type": "string" },
            "role": { "type": "string" },
            "page": { "type": "string", "enum": ["command", "knowledge"] },
            "title": { "type": "string" },
            "createdAt": { "type": "string", "format": "date-time" },
            "lastActivityAt": { "type": "string", "format": "date-time" },
            "tags": { "type": "array", "items": { "type": "string" } }
        }
    },
    "aiMessage": {
        "title": "AI Message",
        "description": "A message within an AI chat session.",
        "type": "object",
        "properties": {
            "msgId": { "type": "string" },
            "orgId": { "type": "string" },
            "sessionId": { "type": "string" },
            "sender": { "type": "string", "enum": ["user", "ai", "system"] },
            "body": { "type": "string" },
            "attachments": { "type": "array", "items": { "type": "object", "properties": { "name": { "type": "string" }, "path": { "type": "string" }, "type": { "type": "string" } } } },
            "actionsSuggested": { "type": "array", "items": { "type": "object", "properties": { "type": { "type": "string" }, "label": { "type": "string" }, "payload": { "type": "object" } } } },
            "sqlPreview": { "type": "string" },
            "dashboardRef": { "type": "string" },
            "error": { "type": "string" },
            "createdAt": { "type": "string", "format": "date-time" }
        }
    },
    "aiExecution": {
        "title": "AI Execution",
        "description": "An execution of a command suggested by the AI.",
        "type": "object",
        "properties": {
            "execId": { "type": "string" },
            "orgId": { "type": "string" },
            "sessionId": { "type": "string" },
            "command": { "type": "string" },
            "parameters": { "type": "object" },
            "requestedBy": { "type": "string" },
            "role": { "type": "string" },
            "status": { "type": "string", "enum": ["proposed", "approved", "rejected", "executed", "failed"] },
            "resultSummary": { "type": "string" },
            "resultPath": { "type": "string" },
            "error": { "type": "string" },
            "createdAt": { "type": "string", "format": "date-time" },
            "executedAt": { "type": "string", "format": "date-time" }
        }
    },
    "aiSavedQuery": {
        "title": "AI Saved Query",
        "description": "A user-saved query from a natural language prompt.",
        "type": "object",
        "properties": {
            "queryId": { "type": "string" },
            "orgId": { "type": "string" },
            "title": { "type": "string" },
            "prompt": { "type": "string" },
            "nlIntent": { "type": "string" },
            "sqlText": { "type": "string" },
            "params": { "type": "object" },
            "createdBy": { "type": "string" },
            "createdAt": { "type": "string", "format": "date-time" }
        }
    },
    "aiSqlExport": {
        "title": "AI SQL Export",
        "description": "An export of data from an AI-generated SQL query.",
        "type": "object",
        "properties": {
            "exportId": { "type": "string" },
            "orgId": { "type": "string" },
            "queryId": { "type": "string" },
            "sessionId": { "type": "string" },
            "format": { "type": "string", "enum": ["CSV", "PARQUET"] },
            "storagePath": { "type": "string" },
            "rowCount": { "type": "number" },
            "createdAt": { "type": "string", "format": "date-time" },
            "expiresAt": { "type": "string", "format": "date-time" }
        }
    },
    "aiKnowledgeSource": {
        "title": "AI Knowledge Source",
        "description": "A source document for the RAG knowledge base.",
        "type": "object",
        "properties": {
            "sourceId": { "type": "string" },
            "orgId": { "type": "string" },
            "type": { "type": "string", "enum": ["pdf", "web", "policy", "faq", "sop", "adr"] },
            "title": { "type": "string" },
            "url": { "type": "string", "format": "uri" },
            "storagePath": { "type": "string" },
            "checksum": { "type": "string" },
            "chunks": { "type": "integer" },
            "lastIndexedAt": { "type": "string", "format": "date-time" },
            "enabled": { "type": "boolean" }
        }
    },
    "aiKnowledgeFeedback": {
        "title": "AI Knowledge Feedback",
        "description": "User feedback on a knowledge base response.",
        "type": "object",
        "properties": {
            "fbId": { "type": "string" },
            "orgId": { "type": "string" },
            "sessionId": { "type": "string" },
            "msgId": { "type": "string" },
            "helpful": { "type": "boolean" },
            "comment": { "type": "string" },
            "createdAt": { "type": "string", "format": "date-time" }
        }
    },
    "auditLog": {
        "title": "Audit Log",
        "description": "A log of system and user actions for auditing purposes.",
        "type": "object",
        "properties": {
            "logId": { "type": "string" },
            "orgId": { "type": "string" },
            "userId": { "type": "string" },
            "role": { "type": "string" },
            "action": { "type": "string" },
            "target": { "type": "string" },
            "payloadHash": { "type": "string" },
            "createdAt": { "type": "string", "format": "date-time" }
        }
    },
    "aiKnowledgeChunk": {
        "title": "AI Knowledge Chunk",
        "description": "A chunk of a document for vector search.",
        "type": "object",
        "properties": {
            "chunkId": { "type": "string" },
            "orgId": { "type": "string" },
            "sourceId": { "type": "string" },
            "hash": { "type": "string" },
            "tokenCount": { "type": "integer" },
            "embeddingRef": { "type": "string" },
            "page": { "type": "integer" },
            "section": { "type": "string" }
        }
    }
  },
  "auth": {
    "providers": ["password", "google.com"]
  },
  "firestore": {
    "/users/{userId}": {
      "schema": { "$ref": "#/entities/userProfile" },
      "description": "Stores public profiles for all users."
    },
    "/drivers/{driverId}": {
        "schema": { "$ref": "#/entities/driver" },
        "description": "Stores information about drivers."
    },
    "/trips/{tripId}": {
        "schema": { "$ref": "#/entities/trip" },
        "description": "Stores trip information."
    },
    "/inspectionSessions/{sessionId}": {
        "schema": { "$ref": "#/entities/inspectionSession" },
        "description": "Stores video inspection sessions."
    },
    "/driverExpenses/{expenseId}": {
        "schema": { "$ref": "#/entities/driverExpense" },
        "description": "Stores driver-submitted expenses."
    },
    "/directMessages/{messageId}": {
        "schema": { "$ref": "#/entities/directMessage" },
        "description": "Stores direct messages between users."
    },
    "/vehicleInspections/{inspectionId}": {
      "schema": { "$ref": "#/entities/vehicleInspection"},
      "description": "Stores vehicle video inspections."
    },
    "/aiChatSessions/{sessionId}": {
      "schema": { "$ref": "#/entities/aiChatSession" },
      "description": "Stores AI chat sessions."
    },
    "/aiMessages/{msgId}": {
      "schema": { "$ref": "#/entities/aiMessage" },
      "description": "Stores messages for AI chat sessions."
    },
    "/aiExecutions/{execId}": {
      "schema": { "$ref": "#/entities/aiExecution" },
      "description": "Logs AI-driven command executions."
    },
    "/aiSavedQueries/{queryId}": {
      "schema": { "$ref": "#/entities/aiSavedQuery" },
      "description": "Stores user-saved natural language queries."
    },
    "/aiSqlExports/{exportId}": {
      "schema": { "$ref": "#/entities/aiSqlExport" },
      "description": "Logs AI-driven SQL data exports."
    },
    "/aiKnowledgeSources/{sourceId}": {
      "schema": { "$ref": "#/entities/aiKnowledgeSource" },
      "description": "Stores sources for the knowledge base."
    },
    "/aiKnowledgeFeedback/{fbId}": {
      "schema": { "$ref": "#/entities/aiKnowledgeFeedback" },
      "description": "Stores user feedback on knowledge base answers."
    },
    "/auditLogs/{logId}": {
      "schema": { "$ref": "#/entities/auditLog" },
      "description": "Stores audit logs for system actions."
    },
    "/aiKnowledgeChunks/{chunkId}": {
      "schema": { "$ref": "#/entities/aiKnowledgeChunk" },
      "description": "Stores document chunks for vector search."
    }
  }
}

    